# Веб-приложение "Каталог фильмов онлайн кинотеатра"

### Описание:
В этом проекте предлагается создать веб-приложение для управления библиотекой сериалов пользователями. Приложение должно позволять пользователям создавать, просматривать и удалять Сезоны и Эпизоды сериалов. Также можно добавить функционал для поиска Эпизода.

### Требования:
- Веб-интерфейс позволяет создавать, просматривать, осуществлять поиск (по описанию эпизода) и удалять информацию о Сезонах (связь к сериалу, название сезона, рейтинг, продолжительность, описание) и Эпизоды (связь к сериалу, связь к эпизоду, название сезона, рейтинг, продолжительность, описание) сериалов.
- Эпизоды и Серии сохраняются в базе данных, чтобы они были доступны между сессиями.
- В api реализована проверка аутентификации пользователей для операций Добавления и Удаления сущностей (в рамках данного этапа в интерфейс форма авторизации не выноситься)
- Реализация vue SPA-приложения для отображения пользовательского интерфейса.

### Развертывание
Развертывание сервиса должно осуществляться с использованием docker compose в директории с проектом.

### Тестирование
Написаны юнит-тесты на core логику приложения.

## Описание решения
### Архитектура
За основы архитектурного паттерна приложения была выбран подход чистой архитектуры с разделением на слои

Инфраструктурный слой 
- Репозиторий реализован на основании ORM (gorm).
- Репозиторий реализовывает интерфейс от которого в свою очередь зависит бизнес логика. 
- Сам интерфейс зависит от интерфейса модели с которой репозиторий будет работать

Сервисный слой
- Слой бизнес логики, который зависит от интерфейса репозитория

Интерфейсный слой 
- Содержит реализацию тонких контроллеров, которые внутри вызывают сервисный слой
### Middleware
Для контроллеров реализовано middleware, которое отвечает за замеры времени выполнения, формирования ответа и проверки аутентификации

### Restful архитектура
- Использован архитектурный паттерн restful.
- Для основных команд реализованы CRUD - action. По списку команд был сгенерирован Swagger

### Интеграционные тесты
- Были описаны интеграционные тесты сервисного слоя
- Часть тестов работает с репозиторием и БД, часть тестов использует mock'и

### Архитектура SPA приложения
- для интерфейса разработано SPA приложение на Vue 3 + pinia (composition api)
- Архитектура приложения реализует паттерн MVC.
Где контроллер реагирует на пользовательский ввод, сохраняет в statemanager(pinia), оперирует отдельными коллекциями состоящими из богатых моделей, 
с последующей передачей данных в шаблон/представление реализованное на реактивном фреймворке Vue

### Getting started
Перед запуском сервиса необходимо установить миграции
Установка миграций
```sh
task migration-up
```
Откат миграций
```sh
task migration-down
```

Чтобы запустить код, используйте команду `go run`:

```sh
go run cmd/server/main.go
```

Затем перейдите на страницу [`localhost:8080/`](http://localhost:8080/) в своем браузере, чтобы увидеть ответ!

## Разработка
### Генерация Swagger
- Для генерации Swagger установка зависимостей и выполнение команды
Зависимости
```sh
go install github.com/swaggo/swag/cmd/swag@latest
go get -u github.com/swaggo/swag/cmd/swag  
go get -u github.com/swaggo/gin-swagger
go get -u github.com/swaggo/files
```
Генерация
```sh
~/go/bin/swag init -g cmd/internal/application/service.go   
```
### Тесты
Для запуска тестов необходмы зависимости
Зависимости
```sh
go install github.com/golang/mock/mockgen@latest
```
Чтобы запустить код, используйте команду `go test`:
```sh
go test movies_online/internal/core -race -count 100
```
### Линтер
Установка
```sh
brew install golangci-lint
```
```sh
brew upgrade golangci-lint
```
Запуск
```sh
golangci-lint run 
```